# START proxy entities
type AdminChanged @entity(immutable: true) {
  id: Bytes!
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
  previousAdmin: Bytes!
  newAdmin: Bytes!
  depositPool: Bytes!
}

type BeaconUpgraded @entity(immutable: true) {
  id: Bytes!
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
  beacon: Bytes!
  depositPool: Bytes!
}

type Initialized @entity(immutable: true) {
  id: Bytes!
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
  version: Int!
  depositPool: Bytes!
}

type Upgraded @entity(immutable: true) {
  id: Bytes!
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
  implementation: Bytes!
  depositPool: Bytes!
}
# END

# START owner entity
type OwnershipTransferred @entity(immutable: true) {
  id: Bytes!
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
  previousOwner: Bytes!
  newOwner: Bytes!
  depositPool: Bytes!
}
# END

type User @entity {
  "id forms from the `tx.sender` + `rewardPoolId` + `depositPool`"
  id: Bytes!
  address: Bytes!
  rewardPoolId: BigInt!
  depositPool: Bytes!
  staked: BigInt!
  claimed: BigInt!
  interactions: [PoolInteraction!]! @derivedFrom(field: "user")
}

type PoolInteraction @entity(immutable: true) {
  "id forms from tx hash + counter"
  id: Bytes!

  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!

  user: User!
  type: BigInt!
  amount: BigInt!
}

# The entity counts interactions in single tx
type InteractionCount @entity {
  id: Bytes!
  count: BigInt!
}

# User who delegated tokens
type Referral @entity {
  "id forms from `user.id` + `referrer.id`"
  id: Bytes!

  referral: User!
  referrer: Referrer!

  referralAddress: Bytes!
  referrerAddress: Bytes!

  amount: BigInt!
}

# User to whom tokens have been delegated
type Referrer @entity {
  "The same as `user.id`"
  id: Bytes!
  user: User!
  referrerAddress: Bytes!

  claimed: BigInt!

  referrals: [Referral!]! @derivedFrom(field: "referrer")
}
